<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="mingchao.wang">
        <link rel="canonical" href="https://mingchao.wang/002_%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0/05_%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>逻辑回归 - 算法工程师笔记</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/obsidian.min.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/django.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/python.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-274394082"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-274394082');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="../..">算法工程师笔记</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/wmc1992/" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-9" role="main">

<h1 id="_1">逻辑回归<a class="headerlink" href="#_1" title="Permanent link">#</a></h1>
<h2 id="_2">一、模型基础<a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>特征集为X，标签为Y。标签Y的取值空间为<span class="arithmatex"><span class="MathJax_Preview">\{0, 1\}</span><script type="math/tex">\{0, 1\}</script></span>，X的特征数量为<span class="arithmatex"><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span>，总共有<span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>条数据。</p>
<p>模型为：</p>
<div class="arithmatex">
<div class="MathJax_Preview">h_{\theta}(x) = \frac{1}{1+e^{-\theta^Tx}}</div>
<script type="math/tex; mode=display">h_{\theta}(x) = \frac{1}{1+e^{-\theta^Tx}}</script>
</div>
<p>定义 <span class="arithmatex"><span class="MathJax_Preview">g(z)=\frac{1}{1+e^{-z}}</span><script type="math/tex">g(z)=\frac{1}{1+e^{-z}}</script></span>，则有<span class="arithmatex"><span class="MathJax_Preview">h_{\theta}(x)=g(\theta^Tx)</span><script type="math/tex">h_{\theta}(x)=g(\theta^Tx)</script></span></p>
<p>假设<span class="arithmatex"><span class="MathJax_Preview">h_{\theta}(x)</span><script type="math/tex">h_{\theta}(x)</script></span>表示<span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>取值为<span class="arithmatex"><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span>时的概率，即：</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \begin{cases}
  p(y=1|x;\theta) &amp;= h_{\theta}(x) \\
  p(y=0|x;\theta) &amp;= 1-h_{\theta}(x)
\end{cases}</div>
<script type="math/tex; mode=display"> \begin{cases}
  p(y=1|x;\theta) &= h_{\theta}(x) \\
  p(y=0|x;\theta) &= 1-h_{\theta}(x)
\end{cases}</script>
</div>
<p>上面这个式子可以写成更简练的形式，如下</p>
<div class="arithmatex">
<div class="MathJax_Preview">p(y|x;\theta) = h_{\theta}(x)^{y}(1-h_{\theta}(x))^{1-y}</div>
<script type="math/tex; mode=display">p(y|x;\theta) = h_{\theta}(x)^{y}(1-h_{\theta}(x))^{1-y}</script>
</div>
<p>有上面的假设，根据极大似然估计有目标函数如下：</p>
<div class="arithmatex">
<div class="MathJax_Preview">L(\theta) =
      \prod_{i=1}^n \Big[
      h_{\theta}(x^{(i)})^{y^{(i)}} \cdot
      (1-h_{\theta}(x^{(i)}))^{1-y^{(i)}} \Big] </div>
<script type="math/tex; mode=display">L(\theta) =
      \prod_{i=1}^n \Big[
      h_{\theta}(x^{(i)})^{y^{(i)}} \cdot
      (1-h_{\theta}(x^{(i)}))^{1-y^{(i)}} \Big] </script>
</div>
<p>目的是极大化这个目标函数，当前的形式不容易看出来，两边取<span class="arithmatex"><span class="MathJax_Preview">\log</span><script type="math/tex">\log</script></span>得到对数似然函数：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\ell (\theta) =
      \log L(\theta) =
      \sum_{i=1}^{n} \Big[
      y^{(i)} \log h_{\theta}(x^{(i)}) +
      (1-y^{(i)}) \log (1-h_{\theta}(x^{(i)})) \Big] </div>
<script type="math/tex; mode=display">\ell (\theta) =
      \log L(\theta) =
      \sum_{i=1}^{n} \Big[
      y^{(i)} \log h_{\theta}(x^{(i)}) +
      (1-y^{(i)}) \log (1-h_{\theta}(x^{(i)})) \Big] </script>
</div>
<p>采用梯度上升算法极大化该对数似然函数，公式如下：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\theta_j := \theta_j+\alpha \nabla </div>
<script type="math/tex; mode=display">\theta_j := \theta_j+\alpha \nabla </script>
</div>
<h2 id="_3">二、求解梯度<a class="headerlink" href="#_3" title="Permanent link">#</a></h2>
<p>为了后续求解简单，先将<span class="arithmatex"><span class="MathJax_Preview">g(z)</span><script type="math/tex">g(z)</script></span>的偏导求解出来，待后面使用：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\begin{aligned}
  g'(z) &amp;= \frac{\partial}{\partial z}g(z) \\
        &amp;= -\frac{1}{(1+e^{-z})^2} \frac{\partial}{\partial z}(1+e^{-z}) \\
        &amp;= \frac{1+e^{-z}-1}{(1+e^{-z})^2} \\
        &amp;= \frac{1}{1+e^{-z}} - \frac{1}{(1+e^{-z})^2} \\
        &amp;= g(z)(1-g(z))
\end{aligned}</div>
<script type="math/tex; mode=display">\begin{aligned}
  g'(z) &= \frac{\partial}{\partial z}g(z) \\
        &= -\frac{1}{(1+e^{-z})^2} \frac{\partial}{\partial z}(1+e^{-z}) \\
        &= \frac{1+e^{-z}-1}{(1+e^{-z})^2} \\
        &= \frac{1}{1+e^{-z}} - \frac{1}{(1+e^{-z})^2} \\
        &= g(z)(1-g(z))
\end{aligned}</script>
</div>
<p>接下来对对数似然函数求偏导：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\begin{aligned}
\frac{\partial}{\partial \theta_j}\ell (\theta_j)
  &amp;= \frac{\partial}{\partial \theta_j} \sum_{i=1}^{n} \Big[
       y^{(i)} \log h_{\theta_j}(x^{(i)}) +
       (1-y^{(i)}) \log (1-h_{\theta_j}(x^{(i)})) \Big] \\
  &amp;= \sum_{i=1}^n \Big[ \frac{y^{(i)}}{h_{\theta_j}(x^{(i)})} -
       \frac{1-y^{(i)}}{1-h_{\theta_j}(x^{(i)})} \Big] \frac{\partial}{\partial \theta_j} h_{\theta_j}(x^{(i)}) \\
  &amp;= \sum_{i=1}^n \frac{y^{(i)} - h_{\theta_j}(x^{(i)})}{h_{\theta_j}(x^{(i)})(1-h_{\theta_j}(x^{(i)}))} \frac{\partial}{\partial \theta_j} h_{\theta_j}(x^{(i)}) \\
\end{aligned}</div>
<script type="math/tex; mode=display">\begin{aligned}
\frac{\partial}{\partial \theta_j}\ell (\theta_j)
  &= \frac{\partial}{\partial \theta_j} \sum_{i=1}^{n} \Big[
       y^{(i)} \log h_{\theta_j}(x^{(i)}) +
       (1-y^{(i)}) \log (1-h_{\theta_j}(x^{(i)})) \Big] \\
  &= \sum_{i=1}^n \Big[ \frac{y^{(i)}}{h_{\theta_j}(x^{(i)})} -
       \frac{1-y^{(i)}}{1-h_{\theta_j}(x^{(i)})} \Big] \frac{\partial}{\partial \theta_j} h_{\theta_j}(x^{(i)}) \\
  &= \sum_{i=1}^n \frac{y^{(i)} - h_{\theta_j}(x^{(i)})}{h_{\theta_j}(x^{(i)})(1-h_{\theta_j}(x^{(i)}))} \frac{\partial}{\partial \theta_j} h_{\theta_j}(x^{(i)}) \\
\end{aligned}</script>
</div>
<p>将<span class="arithmatex"><span class="MathJax_Preview">h_{\theta}(x)=g(z)</span><script type="math/tex">h_{\theta}(x)=g(z)</script></span>和<span class="arithmatex"><span class="MathJax_Preview">g'(z)=g(z)(1-g(z))</span><script type="math/tex">g'(z)=g(z)(1-g(z))</script></span>代入上式继续化简：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\begin{aligned}
\frac{\partial}{\partial \theta_j}\ell (\theta_j)
  &amp;= \sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)})) \frac{\partial}{\partial \theta_j} (\theta^T x) \\
  &amp;= \sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)}))x_j
\end{aligned}</div>
<script type="math/tex; mode=display">\begin{aligned}
\frac{\partial}{\partial \theta_j}\ell (\theta_j)
  &= \sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)})) \frac{\partial}{\partial \theta_j} (\theta^T x) \\
  &= \sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)}))x_j
\end{aligned}</script>
</div>
<p>即梯度<span class="arithmatex"><span class="MathJax_Preview">\nabla=\sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)}))x_j</span><script type="math/tex">\nabla=\sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)}))x_j</script></span>，则梯度上升算法公式如下：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\theta_j := \theta_j + \alpha \sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)}))x_j</div>
<script type="math/tex; mode=display">\theta_j := \theta_j + \alpha \sum_{i=1}^n (y^{(i)} - h_{\theta_j}(x^{(i)}))x_j</script>
</div>
<p>这里的<span class="arithmatex"><span class="MathJax_Preview">x^{(i)}</span><script type="math/tex">x^{(i)}</script></span>和<span class="arithmatex"><span class="MathJax_Preview">y^{(i)}</span><script type="math/tex">y^{(i)}</script></span>都表示一条数据，转换成矩阵形式，公式如下：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\theta_j := \theta_j + (y-h_{\theta_j}(x))x_j</div>
<script type="math/tex; mode=display">\theta_j := \theta_j + (y-h_{\theta_j}(x))x_j</script>
</div>
<p>转换为更为常见的梯度下降的形式（即减去负梯度）：</p>
<div class="arithmatex">
<div class="MathJax_Preview">\theta_j := \theta_j - (h_{\theta_j}(x)-y)x_j</div>
<script type="math/tex; mode=display">\theta_j := \theta_j - (h_{\theta_j}(x)-y)x_j</script>
</div>
<p>PS: 上面的矩阵形式的梯度下降是由<span class="arithmatex"><span class="MathJax_Preview">\sum_{i=1}^n</span><script type="math/tex">\sum_{i=1}^n</script></span>的形式的公式变换得到的，即该公式表示每次迭代更新<span class="arithmatex"><span class="MathJax_Preview">\theta</span><script type="math/tex">\theta</script></span>时都使用所有的<span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>条数据，是一种全量的梯度下降。在实际工程中由于数据量太大，一般采用随机梯度下降。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021 Microsoft Research;<a href="https://beian.miit.gov.cn/">备案号：京ICP备2022025323号-1</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../mathjax-config.js" defer></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
